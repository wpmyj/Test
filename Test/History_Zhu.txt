+===========================================================+
+--------------------UDS Scanner项目历史__Zhu---------------+         
+===========================================================+

date 16.11.01
------------------------------------------------------------
@author zhu
1.设置参数的默认值，扫描类型为自动进纸器、图形类型为彩色、分辨率为200、单面/双面为单面、对比度为0、亮度为0、阈值为230（滑动条上为0）、重张检测默认选中。
2、CTWAINDS_UDS文件添加所用参数注释


date 16.11.03
------------------------------------------------------------
@author zhu
1.隐藏“显示图片”按钮，只供虚拟扫描仪使用
2.重新排版基本设置界面
3.修改流程，点击确定按钮时，才保存所选设置
4.修改CPage_Base::OnOK()，使用map添加各下拉框改变时的状态监测，key值存ICAP等值，value存对应的数值

@author zhu
1.添加SetControl（），设置修改的参数
2.添加“保存当前模板”按钮的消息响应函数OnBase_Btn_Saveprofile()；


date 16.11.04
------------------------------------------------------------
@author zhu
高级设置界面
1、修改Combo纸张大小的值
2、修改CTWAINDS_UDS的Initialize()，添加图像旋转所需功能（|| !pnCap->Add(ICAP_ROTATION)）及其值TWOR_ROT0，TWOR_ROT90，TWOR_ROT180，TWOR_ROT270
3、添加Combo分辨率、图像旋转的值

4.完善图像旋转功能

5.同样添加SetControl函数，
6.添加CPage_Advanced::OnOK()
7.使用map添加“纸张方向、纸张大小、单位”下拉框改变时的状态监测

8.添加高级设置界面分辨率与旋转图像下拉框 改变的消息响应函数OnCbnSelchangeAdvanced_Combo_Resolution与OnCbnSelchangeAdvanced_Combo_Rotate。
9.使用GetDlgItem(IDC_CHECK_FRONTCOLOR)->EnableWindow(FALSE);方式设置多流输出下的选项默认不选中

date 16.11.07
------------------------------------------------------------
@author zhu
1.滑动条亮度、对比度以及编辑框均初始为False
2.添加SetMultistream（）函数根据m_check_multistream.GetCheck()状态设置各参数能否使用

date 16.11.08
------------------------------------------------------------
@author zhu
1.修改基本界面与高级界面的控制流程。由于属性页的确认控制都是由一个OnOK控制的，如果当客户在选择了基本界面的参数后，又直接进入了高级设置，从高级设置界面点击确认按钮时，就只会设置高级设置界面的参数，所以讨论后仍然决定是每一次点击Combo时设置（SetCap）.
2.添加OnNMCustomdrawAdvanced_Slider_Brightness，OnNMCustomdrawAdvanced_Slider_Contrast，OnEnChangeAdvanced_Edit_Contrast，OnEnChangeAdvanced_Edit_Brightness，（滑动条与编辑框的消息响应函数）
3.调试高级界面图像旋转功能无效的问题。

date 16.11.09
------------------------------------------------------------
@author zhu
1、增加高级设置的滑动条等控制
2、去除旋转相关的功能

3.增加旋转的功能，分别在CTWAINDS_UDS类中的StoreCustomDSdata、ReadCustomDSdata、Initialize、updateScannerFromCaps函数中添加相应的代码，把ICAP_ROTATION增加进容器。
4、在CScanner_FreeImage类中的SUDS_Setting结构体增加变量，并在resetScanner、setSetting函数添加对应的赋值语句
5、最重要的是要在CScanner_FreeImage类的preScanPrep函数中增加相应的图像处理代码。
但是该版本旋转90、270时只显示一半，旋转180时左侧图像有丢失。

date 16.11.10
------------------------------------------------------------
@author zhu
1、查找选择黑白时，出图为纯白色的问题，最终发现是因为阈值默认设置为0 ，所以把大于0的部分全部设置为白色了
2、添加InitComboPixType（）函数，判断选择黑白图时，阈值可用，亮度、对比度不可用；其他相反。
3、选择黑白图时阈值默认为230，其他按滑动条设置
4、完成纸张方向（横向、纵向）；此处是逆时针旋转，旋转图像功能是顺时针旋转

date 16.11.11
------------------------------------------------------------
@author zhu
1、补全纸张大小的所有参数选项，增加A3,ISOB4,JISB4,最大扫描，并测试通过
2、查找其他功能参数在twain中的对应，注释twain.h
3、调试但未解决一个Bug,长纸模式未加入纸张大小选项中。

date 16.11.14
------------------------------------------------------------
@author zhu
1、解决长纸模式未加入的问题，在CTWAIN_UDS的Initialize中忘记Add(CUSTCAP_LONGDOCUMENT)
2、为二值化添加下拉框的选项值，添加OnCbnSelchangeAdvanced_Combo_Binarization函数，以及OnCbnSelchangeAdvanced_Combo_SpiltImage函数
3、添加函数SetBinarization，处理二值化选择动态阈值时，对应去除斑点滑动条的范围，设置默认值为20；选择固定阈值时，对应底色保留滑动条的范围，设置默认值为128；两者互斥。

4、合并与宛的冲突的代码

date 16.11.15
------------------------------------------------------------
@author zhu
1、解决旋转与横向/纵向的冲突，横向时旋转框架
2、增加高级设置其他几个checkBox（去除空白页、去除穿孔、锐化图像、Gamma图像校正、图像镜像处理、去除背景、去除网纹、去除噪声、自动裁切与校正）的响应以及对应的CAP、选项值
3、但是功能实现存在Bug，调试当中

date 16.11.16
------------------------------------------------------------
@author zhu
1、SetCapInt返回0，错误，调试到_datCap
2、SetCapValueInt一直返回为0，证明是CAP的问题，尝试修改为SetCapValueFloat，并把参数类型也改为float型等
3、改为SetCapValueFloat正确。
CTWAINDS_UDS::Initialize()中改为：
	FLOAT_RANGE fRange;
	fRange.fCurrentValue = 0.0f;
	fRange.fMaxValue = 10.0f;
	fRange.fMinValue = -10.0f;
	fRange.fStepSize = 1.0f;
	// 去除空白页等
	m_IndependantCapMap[ICAP_AUTODISCARDBLANKPAGES] = new CTWAINContainerFix32Range(ICAP_AUTODISCARDBLANKPAGES,fRange, TWQC_ALL);
	if( NULL == dynamic_cast<CTWAINContainerFix32Range*>(m_IndependantCapMap[ICAP_AUTODISCARDBLANKPAGES]))
	{
		::MessageBox(g_hwndDLG,TEXT("Could not create ICAP_AUTODISCARDBLANKPAGES !"),MB_CAPTION,MB_OK);
		//cerr << "Could not create ICAP_AUTODISCARDBLANKPAGES" << endl;
		setConditionCode(TWCC_LOWMEMORY);
		return TWRC_FAILURE;
	}

CTWAINDS_UDS::updateScannerFromCaps()中改为：
	if(0 == (pfRCap = dynamic_cast<CTWAINContainerFix32Range*>(findCapability(ICAP_AUTODISCARDBLANKPAGES))))
	{
		::MessageBox(g_hwndDLG,TEXT("Could not get ICAP_AUTODISCARDBLANKPAGES!"),MB_CAPTION,MB_OK);
		//cerr << "Could not get ICAP_AUTODISCARDBLANKPAGES" << endl;
		bret = false;
	}
	else
	{
		pfRCap->GetCurrent(fVal);
		settings.m_fRemoveBlank = fVal;
	}
4、调试语句
	if(m_nBinarization == TWBZ_HALFTONE4)
	{
	::MessageBox(g_hwndDLG,TEXT("半色调4"),MB_CAPTION,MB_OK);
	}
	else if(m_nBinarization == TWBZ_DYNATHRESHOLD)
	{
	::MessageBox(g_hwndDLG,TEXT("二值化自动可用"),MB_CAPTION,MB_OK);
	}

	if(m_nSpiltImage == TWSI_NONE)
	{
	::MessageBox(g_hwndDLG,TEXT("分割图像不可用"),MB_CAPTION,MB_OK);
	}
	else if(m_nSpiltImage == TWSI_HORIZONTAL)
	{
	::MessageBox(g_hwndDLG,TEXT("水平分割可用"),MB_CAPTION,MB_OK);
	}
	else if(m_nSpiltImage == TWSI_VERTICAL)
	{
	::MessageBox(g_hwndDLG,TEXT("垂直分割可用"),MB_CAPTION,MB_OK);
	}

	if(m_fRemoveBlank == TWBP_DISABLE)
	{
		::MessageBox(g_hwndDLG,TEXT("去除空白页不可用"),MB_CAPTION,MB_OK);
	}
	else if(m_fRemoveBlank == TWBP_AUTO)
	{
		::MessageBox(g_hwndDLG,TEXT("去除空白页可用"),MB_CAPTION,MB_OK);
	}

	if(m_fRemovePunch == TWRP_DISABLE)
	{
		::MessageBox(g_hwndDLG,TEXT("去除穿孔不可用"),MB_CAPTION,MB_OK);
	}
	else if(m_fRemovePunch == TWRP_AUTO)
	{
		::MessageBox(g_hwndDLG,TEXT("去除穿孔可用"),MB_CAPTION,MB_OK);
	}
	/*char buf[1024];
	itoa((int)m_fRemovePunch,buf,10);
	::MessageBox(g_hwndDLG,buf,"去除穿孔值",MB_OK);*/

	if(m_fSharpen == TWSP_DISABLE)
	{
		::MessageBox(g_hwndDLG,TEXT("图像锐化不可用"),MB_CAPTION,MB_OK);
	}
	else if(m_fSharpen == TWSP_AUTO)
	{
		::MessageBox(g_hwndDLG,TEXT("图像锐化可用"),MB_CAPTION,MB_OK);
	}

	if(m_fMirror == TWMR_DISABLE)
	{
		::MessageBox(g_hwndDLG,TEXT("镜像不可用"),MB_CAPTION,MB_OK);
	}
	else if(m_fMirror == TWMR_AUTO)
	{
		::MessageBox(g_hwndDLG,TEXT("镜像可用"),MB_CAPTION,MB_OK);
	}

	if(m_fRemoveBack == TWRB_DISABLE)
	{
		::MessageBox(g_hwndDLG,TEXT("去除背景不可用"),MB_CAPTION,MB_OK);
	}
	else if(m_fRemoveBack == TWRB_AUTO)
	{
		::MessageBox(g_hwndDLG,TEXT("去除背景可用"),MB_CAPTION,MB_OK);
	}

	if(m_fDescreen == TWDS_DISABLE)
	{
		::MessageBox(g_hwndDLG,TEXT("去除网纹不可用"),MB_CAPTION,MB_OK);
	}
	else if(m_fDescreen == TWDS_AUTO)
	{
		::MessageBox(g_hwndDLG,TEXT("去除网纹可用"),MB_CAPTION,MB_OK);
	}

	if(m_fDenoise == TWDN_DISABLE)
	{
		::MessageBox(g_hwndDLG,TEXT("去除噪声不可用"),MB_CAPTION,MB_OK);
	}
	else if(m_fDenoise == TWDN_AUTO)
	{
		::MessageBox(g_hwndDLG,TEXT("去除噪声可用"),MB_CAPTION,MB_OK);
	}

	if(m_fAutoCrop == TWAC_DISABLE)
	{
		::MessageBox(g_hwndDLG,TEXT("自动裁切不可用"),MB_CAPTION,MB_OK);
	}
	else if(m_fAutoCrop == TWAC_AUTO)
	{
		::MessageBox(g_hwndDLG,TEXT("自动裁切可用"),MB_CAPTION,MB_OK);
	}

5、修改CUSTCAP_PUNCHHOLEREMOVEL等参数为UDSCAP_PUNCHHOLEREMOVEL

date 16.11.17
------------------------------------------------------------
@author zhu
1、增加图像分割功能，使用FreeImage_Copy实现；
2、增加镜像处理功能，FreeImage_FlipHorizontal实现
3、修改Gamma校正的方式，从checkBox改为滑动条，滑动条范围为10~255，但实际操作范围为0.1~2.55；
4、但有一个问题就是图像会变为黑白，调试中

date 16.11.18
------------------------------------------------------------
@author zhu
1、解决图像变为黑白的问题；查找到问题在于FreeImage_AdjustGamma时参数m_fGamma为10，导致在FreeImage_AdjustGamma(m_pDIB, m_fGamma/100);后，第二个参数过小，所以导致图像变暗，类似黑白；调整CTWAINDS_UDS.Initialize中，容器pfixCap->Add(1, true)改为pfixCap->Add(100, true)；这样修改后直接从基本界面扫描没有问题，但从高级界面扫描仍然不对，是因为滑动条默认设置为10了，改为100后，正确；从而后面的镜像处理与图像分割功能正常；
2、新建三个属性页，纸张设置、多流输出、图像处理。

date 16.11.21
------------------------------------------------------------
@author zhu
1、为Page_Paper类增加OnVScroll函数，实现滚动条与编辑框同步数值的功能；
2、暂时隐藏其他三个属性页
3、添加纸张大小：自定义，照片64，照片53选项，自定义时宽高可用，其他时候只显示对应的宽高
4、在CScanner_Base类中增加重张进纸检测的数据成员m_bMultifeedDetection，并在CTWAINDS_UDS的Initialize与updateScannerFromCaps添加相应Add与设置代码


date 16.11.22
------------------------------------------------------------
@author zhu
1、列出并测试所有参数对应CAP与对应数据成员
2、在CTWAINDS_UDS类中的updateScannerFromCaps（）中添加扫描模式、单双面、纸张大小、单位这几个参数的设置；
3、在CTWAINDS_UDS类中添加把去除斑点与多流输出两个参数添加进容器的操作。


date 16.11.23
------------------------------------------------------------
@author zhu
1、在CScanner_OpenCV类中增加MedianSmooth（）中值滤波函数
2、根据测试结果，修改去除穿孔等七项checkBox对应的变量值类型从float型改为bool型，保持去除空白页仍为float型
3、解决测试文档中序号3,8,12的问题


date 16.11.24
------------------------------------------------------------
@author zhu
1、修改Base类与Advanced类中的SetCap的位置，最终确定为仍是点击扫描或者保存后才设置，增加SetControl()函数，以及使用map存储Cap值与选中索引值。
2、增加基类CPage_Custom,该类中只有一个虚函数SetControl();Base类与Advanced类均双继承于CPage_Custom类与CPropertyPage类
3、在Base类中增加父类的指针CPage_Custom * m_pAdPage，在CSheet_Scanner类的构造函数中增加m_p_page_base->m_pAdPage = m_p_page_advanced传值;在响应OnOK时，不仅只调用本类的SetControl，还要调用m_pAdPage->SetControl();测试后能够同时响应基本界面与高级界面修改的功能。

date 16.11.25
------------------------------------------------------------
@author zhu
1、增加void NewBaseProfile();用于保存模板；
2、增加void SetCapValue(void);函数用于保存六个常用的模板
3、修改界面显示的值得读取方式，从默认给值改为从容器读值；

date 16.11.28
------------------------------------------------------------
@author zhu
1、修改map的插入方式，从用insert函数插入value_type数据方式改为用数组方式插入数据；能够修改亮度等值，成功扫描(问题在于用insert时，key与value(键值与数据)的插入上涉及到集合的唯一性，即当map中有这个关键字时，insert操作是插入不了数据的，但是用数组方式不同，它是以覆盖以前关键字对应的值得方式插入的)
2、优化了CPage_Advanced类中SetCapValue函数
3、修改基本与高级界面的UpdateControls()与InitSliderCtrl();
4、增加底色保留Cap---UDSCAP_SENSITIVETHRESHOLD_COLORRETENT，以及去除斑点Cap---UDSCAP_SENSITIVETHRESHOLD_REMOVESPOTS,删除CAP---UDSCAP_SENSITIVETHRESHOLD；
5、遗留一个问题：高级设置界面的参数不返回默认模板

date 16.11.29
------------------------------------------------------------
@author zhu
1、解决“修改基本界面的亮度、对比参数，然后从高级扫描，参数设置无效”的问题：因为在基本的OnOK中先设置了亮度，然后再设置了高级界面的SetCapValue，此时这两个参数没有同步，高级仍是上一个模板的值，就又给重新设置回去了；修改办法是在高级的SetCapValue的亮度、对比度加上了判断语句，当且仅当滑动条可用时才SetCapValueFloat；
2、增加CTWAIN_UI::GetCapValueBool()
3、修改几个checkBox的读取方式，从默认代码设置改为从容器读取
4、遗留一个问题：checkbox当前模板的状态未保存
5、解决checkbox当前模板状态未保存的问题，解决方法是在_IndependantCapMap[UDSCAP_SENSITIVETHRESHOLD_COLORRETENT] = new CTWAINContainerFix32Range(UDSCAP_SENSITIVETHRESHOLD_COLORRETENT,fRange, TWQC_GETS);最后一个参数改为TWQC_ALL

date 16.11.30
------------------------------------------------------------
@author zhu
1、解决高级checkbox选中，但在基本界面选择默认模板后，checkBox状态不重置的问题：解决办法是在CPage_Base::OnCbnSelchangeBase_Combo_Profile()中增加m_pAdPage->UpdateControls();

date 16.12.1
------------------------------------------------------------
@author zhu
1、增加CPage_Advanced::SetStandardsizes函数，用来判断纸张大小，选择自定义时，宽高是否可用（针对测试报告问题9做的修复，之前只在UpdateControl中增加判断语句，下拉框改变事件未增加）
2、修改旋转的参数类型为float型，容器类型为CTWAINContainerFix32型（针对测试报告问题12，返回值均为0修改），测试通过
3、解决测试文档模板问题1：弹出“遇到不适当的参数”问题，主问题是在Base界面做更新高级界面参数时（m_pAdPage->UpdateControls()）出错，来回测试最终发现问题在于几处m_edit_brightness.SetWindowText(strText)，调试发现是因为m_edit_brightness.SetWindowText为NULL。修改该句为SetDlgItemText(IDC_ADVANCED_EDIT_BRIGHTNESS, strText)成功。原因是此时高级界面还没有创建，而SetWindowText是当前窗口的句柄，在基本界面并没有edit控件，所以该m_edit_brightness为NULL，若先不改变模板，进入高级界面，再回到基本界面改变模板就不会弹出错误对话框。
4、解决测试文档模板问题6：增加CPage_Base::SetDelete(void)函数，删除按钮是否可用，当是给定模板时，不可用，即不能删除；修改给定模板名字，改为以UDS--开头，并以此判断哪些是给定的模板。